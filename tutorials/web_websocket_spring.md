############################

############################
# WEB WEBSOCKET SPRING
############################

############################

# Websocket examples with Spring

## Example without STOMP and SocksJS
https://github.com/yusuf-daglioglu/raw-websocket-with-spring

## Example with STOMP and SocksJS
https://github.com/yusuf-daglioglu/gs-messaging-stomp-websocket

This is the fork of: https://github.com/spring-guides/gs-messaging-stomp-websocket

The stable version is on this git tag: https://github.com/spring-guides/gs-messaging-stomp-websocket/tree/2.1.6.RELEASE

This is the minimalist example of Websocket (via SocksJS and STOMP & on back-end Spring).

# Web UI
http://localhost:8080

# Websocket URL
After first HTTP request, client start a websocket from this URL:

```
/gs-guide-websocket/953/0lej1i41/websocket
```

- /gs-guide-websocket

  is the config which we wrote on Spring side

- /953

  This is random 3 number generated by client. It named as "Server-id" on SockJS protocol. Optionally server can route the requests on different servers (via load balancer...). SockJS tells nothin about server side for this value.

- /0lej1i41

  "session-id" is the standart of SocksJS. Each new connection (not message or subscription!) of SockJS, creates a new random session-id. It is generated by client.

- /websocket

  "transport" information. with which technology the client wants to transmit data. the value could be: xhr-streaming.

## URL with /info path
Client send HTTP-upgrade request to /info suffixed URL. "info" is a standart of SockJS. So we did not write any config to Spring about this URL. SockJS integration of Spring added this suffix automatically.

## Explanations of Java source code

```java
@Override
public void configureMessageBroker(MessageBrokerRegistry config) {

    // This config makes to run a built-in message-broker.
    // All topics that will be simulated via that broker should start with /topic.
    // In another word, when a message comes to /topic prefixed destination,
    // the subscriptions and broadcasting will be managed by Spring built-in message broker.
    config.enableSimpleBroker("/topic");

    // if client send a message to destination which has prefix "/app",
    // that message will be redirected to @MessageMapping methods in @Controller classes.
    config.setApplicationDestinationPrefixes("/app");
}

@Override
public void registerStompEndpoints(StompEndpointRegistry registry) {

    // This URL will be called by client on the upgrade-HTTP request.
    registry.addEndpoint("/gs-guide-websocket").withSockJS();
}
```

```java
@MessageMapping("/hello") // if client will send a STOMP message to /app/hello, this method will be triggered by Spring.
@SendTo("/topic/greetings") // return value from this value will be sent to /topic/greetings automatically by Spring.
public Greeting greeting(HelloMessage message) throws Exception {
    Thread.sleep(1000); // simulated delay
    return new Greeting("Hello, " + HtmlUtils.htmlEscape(message.getName()) + "!");
}
```
